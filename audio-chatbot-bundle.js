(()=>{"use strict";var t={56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var o={},a=[],r=0;r<t.length;r++){var c=t[r],l=i.base?c[0]+i.base:c[0],d=o[l]||0,p="".concat(l," ").concat(d);o[l]=d+1;var u=n(p),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)e[u].references++,e[u].updater(h);else{var v=s(h,i);i.byIndex=r,e.splice(r,0,{identifier:p,updater:v,references:1})}a.push(p)}return a}function s(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,s){var o=i(t=t||[],s=s||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var r=n(o[a]);e[r].references--}for(var c=i(t,s),l=0;l<o.length;l++){var d=n(o[l]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}o=c}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,s,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(i)for(var r=0;r<this.length;r++){var c=this[r][0];null!=c&&(a[c]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);i&&a[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),e.push(d))}},e}},365:(t,e,n)=>{n.d(e,{A:()=>r});var i=n(601),s=n.n(i),o=n(314),a=n.n(o)()(s());a.push([t.id,".chatbot-container {\n  max-width: 400px;\n  margin: 20px auto;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  font-family: Arial, sans-serif;\n}\n\n.chatbot-header {\n  background-color: var(--primary-color);\n  color: white;\n  padding: 15px;\n  text-align: center;\n}\n\n.chatbot-title {\n  margin: 0;\n  font-size: 1.5em;\n}\n\n.main-area {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 200px;\n}\n\n.greeting, .session-area {\n  text-align: center;\n}\n\n.pulse-orb, .pulse-circle {\n  width: 50px;\n  height: 50px;\n  margin: 20px auto;\n  position: relative;\n}\n\n.mic-icon {\n  width: 100%;\n  height: 100%;\n  fill: var(--primary-color);\n  position: relative;\n  z-index: 1;\n}\n\n.pulse-ring {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  border: 2px solid var(--primary-color);\n  border-radius: 50%;\n  animation: pulse 1.5s infinite;\n}\n\n.pulse-ring:nth-child(2) {\n  animation-delay: 0.33s;\n}\n\n.pulse-ring:nth-child(3) {\n  animation-delay: 0.66s;\n}\n\n@keyframes pulse {\n  0% {\n    transform: scale(1);\n    opacity: 1;\n  }\n  100% {\n    transform: scale(1.5);\n    opacity: 0;\n  }\n}\n\n.status-text {\n  font-size: 1.2em;\n  color: var(--secondary-color);\n}\n\n.chat-controls {\n  display: flex;\n  justify-content: center;\n  padding: 15px;\n}\n\n.control-button {\n  background-color: var(--primary-color);\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  margin: 0 10px;\n  border-radius: 5px;\n  cursor: pointer;\n  font-size: 1em;\n}\n\n.control-button:disabled {\n  background-color: #ccc;\n  cursor: not-allowed;\n}\n\n#audioOutput {\n  display: none;\n}\n\n@media (max-width: 600px) {\n  .chatbot-container {\n    max-width: 90%;\n  }\n  .chatbot-title {\n    font-size: 1.2em;\n  }\n  .control-button {\n    padding: 8px 15px;\n    font-size: 0.9em;\n  }\n}",""]);const r=a},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,s&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={id:i,exports:{}};return t[i](o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;var i=n(72),s=n.n(i),o=n(825),a=n.n(o),r=n(659),c=n.n(r),l=n(56),d=n.n(l),p=n(540),u=n.n(p),h=n(113),v=n.n(h),y=n(365),f={};f.styleTagTransform=v(),f.setAttributes=d(),f.insert=c().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=u(),s()(y.A,f),y.A&&y.A.locals&&y.A.locals,window.AudioChatbot=class{constructor(t={}){this.config={title:t.title||"Audio Chatbot",HeaderText:t.HeaderText||"Ready for a Voice Chat?",SubheadText:t.SubheadText||"Click the Start Conversation button to begin.",colors:{primaryColor:t.colors?.primaryColor||"#4c51bf",secondaryColor:t.colors?.secondaryColor||"#2d3748"}},this.container=document.createElement("div"),this.container.className="chatbot-container",this.localStream=null,this.pc=null,this.dc=null,this.render(),this.addEventListeners()}render(){this.container.innerHTML='<div class="chatbot-container">\n  <div class="chatbot-header">\n    <h1 class="chatbot-title">{{title}}</h1>\n  </div>\n  <div class="main-area">\n    <div id="greeting" class="greeting">\n      <div id="pulse-orb" class="pulse-orb">\n        <svg\n          class="mic-icon"\n          xmlns="http://www.w3.org/2000/svg"\n          viewBox="0 0 24 24"\n        >\n          <path\n            d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"\n          />\n          <path\n            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"\n          />\n        </svg>\n      </div>\n      <h3>{{HeaderText}}</h3>\n      <p>{{SubheadText}}</p>\n    </div>\n    <div id="session-area" class="session-area" style="display: none">\n      <div id="pulse-circle" class="pulse-circle">\n        <svg\n          class="mic-icon"\n          xmlns="http://www.w3.org/2000/svg"\n          viewBox="0 0 24 24"\n        >\n          <path\n            d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"\n          />\n          <path\n            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"\n          />\n        </svg>\n        <div class="pulse-ring"></div>\n        <div class="pulse-ring" style="animation-delay: 0.33s"></div>\n        <div class="pulse-ring" style="animation-delay: 0.66s"></div>\n      </div>\n      <p class="status-text" id="statusText">Connecting...</p>\n    </div>\n  </div>\n  <div class="chat-controls">\n    <button class="control-button" id="startButton">Start Conversation</button>\n    <button class="control-button" id="stopButton" disabled>\n      Stop Conversation\n    </button>\n  </div>\n  <audio id="audioOutput" autoplay></audio>\n</div>\n'.replace("{{title}}",this.config.title).replace("{{HeaderText}}",this.config.HeaderText).replace("{{SubheadText}}",this.config.SubheadText),this.container.style.setProperty("--primary-color",this.config.colors.primaryColor),this.container.style.setProperty("--secondary-color",this.config.colors.secondaryColor),document.body.appendChild(this.container)}addEventListeners(){const t=this.container.querySelector("#startButton"),e=this.container.querySelector("#stopButton"),n=this.container.querySelector("#audioOutput");t.addEventListener("click",(()=>this.startConversation())),e.addEventListener("click",(()=>this.stopConversation())),n.addEventListener("play",(()=>{this.updateStatus("AI Speaking...");const t=this.container.querySelector("#pulse-circle");t.classList.remove("listening"),t.classList.add("speaking")})),n.addEventListener("pause",(()=>{this.updateStatus("Listening...");const t=this.container.querySelector("#pulse-circle");t.classList.remove("speaking"),t.classList.add("listening")})),n.addEventListener("ended",(()=>{this.updateStatus("Listening...");const t=this.container.querySelector("#pulse-circle");t.classList.remove("speaking"),t.classList.add("listening")}))}async startConversation(){const t=this.container.querySelector("#startButton"),e=this.container.querySelector("#stopButton"),n=this.container.querySelector("#greeting"),i=this.container.querySelector("#session-area");t.disabled=!0,e.disabled=!1,n.style.display="none",i.style.display="flex",this.updateStatus("Connecting...");const s=await this.getSessionKey();s?await this.initWebRTC(s):this.stopConversation()}stopConversation(){const t=this.container.querySelector("#startButton"),e=this.container.querySelector("#stopButton"),n=this.container.querySelector("#greeting"),i=this.container.querySelector("#session-area");this.cleanupWebRTC(),t.disabled=!1,e.disabled=!0,n.style.display="flex",i.style.display="none",this.updateStatus("Conversation Stopped"),this.container.querySelector("#pulse-circle").classList.remove("listening","speaking")}updateStatus(t){this.container.querySelector("#statusText").textContent=t}async getSessionKey(){try{const t=await fetch("https://ernesto-sessionkey-1.onrender.com/session",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to get session key");const e=await t.json();return console.log("Session key received:",e),e}catch(t){return console.error("Error fetching session key:",t),this.updateStatus("Failed to fetch session key. Please try again."),null}}async initWebRTC(t){try{this.pc=new RTCPeerConnection;const e=this.container.querySelector("#audioOutput");this.pc.ontrack=t=>e.srcObject=t.streams[0],this.localStream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.pc.addTrack(this.localStream.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",(t=>{const e=JSON.parse(t.data);console.log("Event:",e);const n=this.container.querySelector("#pulse-circle");"response.audio.delta"===e.type?(this.updateStatus("AI Speaking..."),n.classList.remove("listening"),n.classList.add("speaking")):"input_audio_buffer.speech_started"===e.type?this.updateStatus("You’re Speaking..."):"input_audio_buffer.speech_stopped"===e.type?(this.updateStatus("Listening..."),n.classList.remove("speaking"),n.classList.add("listening")):"session.updated"===e.type&&console.log("Session configured:",e.session)})),this.dc.onopen=()=>{this.dc.send(JSON.stringify({type:"session.update",session:{instructions:"Respond concisely"}}))},this.pc.onconnectionstatechange=()=>{"disconnected"!==this.pc.connectionState&&"failed"!==this.pc.connectionState||(this.updateStatus("Connection lost. Please restart."),this.stopConversation())};const n=await this.pc.createOffer();await this.pc.setLocalDescription(n);const i="https://api.openai.com/v1/realtime",s="gpt-4o-realtime-preview-2024-12-17",o=await fetch(`${i}?model=${s}`,{method:"POST",body:n.sdp,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/sdp"}}),a={type:"answer",sdp:await o.text()};await this.pc.setRemoteDescription(a),console.log("Real-time connection established!"),this.updateStatus("Listening..."),this.container.querySelector("#pulse-circle").classList.add("listening")}catch(t){console.error("Error initializing WebRTC:",t),this.updateStatus("Failed to initialize WebRTC. Please try again."),this.stopConversation()}}cleanupWebRTC(){this.pc&&(this.pc.close(),this.pc=null,this.dc=null,this.container.querySelector("#audioOutput").srcObject=null),this.localStream&&(this.localStream.getTracks().forEach((t=>t.stop())),this.localStream=null)}}})();